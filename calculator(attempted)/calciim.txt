#include<reg51.h>

sbit key_enb=P1^3;
sfr ldata=0x80;
sbit rs=P1^0;
sbit rw=P1^1;
sbit en=P1^2;
sbit busy=P0^7;
sbit buzzer=P1^5;

void MSDelay(unsigned int value){
unsigned int i,j;
for(i=0;i<value;i++)
for(j=0;j<1275;j++);
}
void lcdready(){

busy=1;
rs=0;
rw=1;
while(busy==1)
{
en=0;
MSDelay(1);
en=1;
}
return;
}

void lcdcmd(unsigned char value){
lcdready();
ldata=value;
rs=0;
rw=0;
en=1;
MSDelay(1);
en=0;
return;
}

void lcddata(unsigned char value){
lcdready();
ldata=value;
rs=1;
rw=0;
en=1;
MSDelay(1);
en=0;
return;
}

void function(){
 double s,s1,s2;
  unsigned char a,b;
  double h,i,j,x,y,z;
 int t,o,c,d,e,f,intodob;
unsigned char y1;
 t=0;
h=i=j=x=y=z=s=s1=s2=0.0;
key_enb=1;
p:
lcddata('0');
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');


m:
P0=0xFF;//make p0 input
MSDelay(1);
key_enb=0;//H-to-L for taking key value
MSDelay(1);
y1=P0;//input value
key_enb=1;//high again
P0=0xFF;//ready for input again
if(y==0xFF)goto m;
else{

MSDelay(20);//debounce of 20ms

key_enb=0;
y1=P0;
key_enb=1;
P0=0xFF;
if(y1==0x7F){lcdcmd(0x80);
//+++
if(t==0){
lcddata('0');
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);
h++;
if(h>9){
h=0;  s1=0.0; }
else {
lcdcmd(0x80);lcdcmd(0x01);
lcddata(h+0x30);
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);


}
	   
	   }
if(t==1){
lcddata(h+0x30);
lcdcmd(0x06);i++;
if(i>9){
i=0;

lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');

       }
else {
lcddata(i+0x30);
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');
}}
if(t==2){

lcddata(h+0x30);
lcdcmd(0x06);
lcddata(i+0x30);
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
j++;
if(j>9){
j=0;

lcddata('0');

       }
else {


lcddata(j+0x30);
}
}
if(t==3){
lcddata('0');
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');


x++;
if(x>9){
x=0;

       }
else {

lcdcmd(0x80);lcdcmd(0x01);
lcddata(x+0x30);
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');

}
}
if(t==4){y++;
lcddata(x+0x30);
lcdcmd(0x06);
if(y>9){
y=0;
lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');
      }
else {
lcddata(y+0x30);
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');
}}
if(t==5){
lcddata(x+0x30);
lcdcmd(0x06);
lcddata(y+0x30);
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
z++;
if(z>9){
z=0;

lcddata('0');

       }
else {

lcddata(z+0x30);
}}
}
else if(y1==0xBF){
lcdcmd(0x80);lcdcmd(0x01);
//---
if(t==0){
lcddata('0');
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');
h--;
if(h<0){
h=9;
lcdcmd(0x80);lcdcmd(0x01);
lcddata('9');
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');

       }
else {
lcdcmd(0x80);lcdcmd(0x01);
lcddata(h+0x30);
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');



}
	   
	   }
if(t==1){lcddata(h+0x30);
lcdcmd(0x06);
i--;
if(i<0){
i=9;
s1=s1+i;
lcddata('9');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');

       }
else {

lcddata(i+0x30);
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');
}}
if(t==2){
lcddata(h+0x30);
lcdcmd(0x06);
lcddata(i+0x30);
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
j--;
if(j<0){
j=9;

lcddata('9');

       }
else {


lcddata(j+0x30);
}
}
if(t==3){lcddata('0');
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');

x--;
if(x<0){
x=9;
lcdcmd(0x80);lcdcmd(0x01);
lcddata('9');
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');

       }
else {

lcdcmd(0x80);lcdcmd(0x01);
lcddata(x+0x30);
lcdcmd(0x06);
lcddata('0');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');

}
}
if(t==4){y--;
lcddata(x+0x30);
lcdcmd(0x06);
if(y<0){
y=9;

lcddata('9');
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');


       }
else {

lcddata(y+0x30);
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata('0');
}}
if(t==5){
lcddata(x+0x30);
lcdcmd(0x06);
lcddata(y+0x30);
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
z--;
if(z<0){
z=9;
lcddata('9');

       }
else {

lcddata(z+0x30);
}}
}

else if(y1==0xDF){lcdcmd(0x80);lcdcmd(0x01);
//-
if(o==1){
s=s1+s2;
if(s<10)
{intodob=s*10;
b=intodob%10;
b=b+0x30;
a=intodob/10;
a=a+0x30;
lcddata('0');
lcdcmd(0x06);
lcddata(a);
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata(b);}
else if(s<100) {
intodob=s*10;
c=intodob%10;
d=intodob%100;
d=d-c;
d=d/10;
e=intodob/100;
a=e+0x30;
lcddata(a);
lcdcmd(0x06);
a=d+0x30;
lcddata(a);
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
a=c+0x30;
lcddata(a);
}
else if(s<1000){
intodob=s*10;//intodob=4digits
c=intodob%10;
d=intodob%100;
d=d-c;
d=d/10;
intodob=intodob/100;
e=intodob%10;
f=intodob/10;
a=f+0x30;
lcddata(a);
a=e+0x30;
lcddata(a);
lcddata('.');
a=d+0x30;
lcddata(a);
a=c+0x30;
lcddata(a);

}

}
else if(o==3){
s=s1/s2;
if(s<10)
{
intodob=s*10;
b=intodob%10;
b=b+0x30;
a=intodob/10;
a=a+0x30;
lcddata('0');
lcdcmd(0x06);
lcddata(a);
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
lcddata(b);}
else if(s<100) {
intodob=s*10;
c=intodob%10;
d=intodob%100;
d=d-c;
d=d/10;
e=intodob/100;
a=e+0x30;
lcddata(a);
lcdcmd(0x06);
a=d+0x30;
lcddata(a);
lcdcmd(0x06);
lcddata('.');
lcdcmd(0x06);
a=c+0x30;
lcddata(a);
}
}

}
else if(y1==0xEF){lcdcmd(0x80);lcdcmd(0x01);
lcddata('/');
o=3;
}
else if(y1==0xF7){lcdcmd(0x80);lcdcmd(0x01);
//output (delete)
buzzer=1;
buzzer=0;
goto p;
}
else if(y1==0xFB){
++t;
if(t==)
if(t>6) t=0;

}
else if(y1==0xFD){lcdcmd(0x80);lcdcmd(0x01);
lcddata('+');
o=1;
}
else if(y1==0xFE){lcdcmd(0x80);lcdcmd(0x01);
if(t==3)
s1=h*10+i+j*0.1;

if(t==6)
s2=x*10+y+0.1*z;
}
goto m;
}}

void main(){

buzzer=0;
lcdcmd(0x38);
lcdcmd(0x08);
lcdcmd(0x01);
lcdcmd(0x06);
lcdcmd(0x0C);
function();
}


